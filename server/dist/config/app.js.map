{"version":3,"sources":["../../config/app.js"],"names":["config","app","server","http","createServer","env","use","passport","strategies","bodyParser","json","urlencoded","extended","initialize","jwt","utils","authMiddleware","middleware","auth","production","express","static","path","join","__dirname","get","req","res","filePath","resolve","sendFile"],"mappings":";;;;;;kBAae,UAAUA,MAAV,EAAkB;AAC/B,MAAIC,MAAM,wBAAV;AACAA,MAAIC,MAAJ,GAAaC,eAAKC,YAAL,CAAkBH,GAAlB,CAAb;;AAEA,MAAID,OAAOK,GAAP,KAAe,KAAnB,EAA0B;AACxBJ,QAAIK,GAAJ,CAAQ,sBAAO,KAAP,CAAR;AACD;;AAN8B,4BAQE,wBAAmBN,MAAnB,CARF;AAAA,MAQvBO,QARuB,uBAQvBA,QARuB;AAAA,MAQbC,UARa,uBAQbA,UARa;;AAU/BP,MAAIK,GAAJ,CAAQG,qBAAWC,IAAX,EAAR;AACAT,MAAIK,GAAJ,CAAQG,qBAAWE,UAAX,CAAsB,EAAEC,UAAU,IAAZ,EAAtB,CAAR;;AAEAX,MAAIK,GAAJ,CAAQ,qBAAR;;AAEAL,MAAIK,GAAJ,CAAQC,SAASM,UAAT,EAAR;AACAN,WAASD,GAAT,CAAa,KAAb,EAAoBE,WAAWM,GAA/B;;AAEA,MAAMC,QAAQ,qBAAgBf,MAAhB,CAAd;;AAEA,MAAMgB,iBAAiB,oBAAyBT,QAAzB,CAAvB;;AAEA,MAAMU,aAAa;AACjBC,UAAMF;AADW,GAAnB;;AAIA,oBAAahB,MAAb;;AAEA,qBAAcC,GAAd,EAAmBD,MAAnB,EAA2Be,KAA3B,EAAkCE,UAAlC;;AAEA,MAAIjB,OAAOmB,UAAX,EAAuB;AACrBlB,QAAIK,GAAJ,CAAQc,kBAAQC,MAAR,CAAeC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAR;;AAEAvB,QAAIwB,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/B,UAAMC,WAAWN,eAAKO,OAAL,CAAaL,SAAb,EAAwB,sBAAxB,CAAjB;AACAG,UAAIG,QAAJ,CAAaF,QAAb;AACD,KAHD;AAID;;AAED,SAAO3B,GAAP;AACD,C;;AArDD;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA","file":"app.js","sourcesContent":["import http from 'http';\nimport express from 'express';\nimport cors from 'cors';\nimport morgan from 'morgan';\nimport bodyParser from 'body-parser';\n\nimport path from 'path';\nimport initializePassport from './passport';\nimport initializeDb from './db';\nimport initializeApi from '../api';\nimport initializeUtils from '../utils';\nimport initializeAuthMiddleware from '../middleware/auth';\n\nexport default function (config) {\n  let app = express();\n  app.server = http.createServer(app);\n\n  if (config.env === 'dev') {\n    app.use(morgan('dev'));\n  }\n\n  const { passport, strategies } = initializePassport(config);\n\n  app.use(bodyParser.json());\n  app.use(bodyParser.urlencoded({ extended: true }));\n\n  app.use(cors());\n\n  app.use(passport.initialize());\n  passport.use('jwt', strategies.jwt);\n\n  const utils = initializeUtils(config);\n\n  const authMiddleware = initializeAuthMiddleware(passport);\n\n  const middleware = {\n    auth: authMiddleware\n  }\n\n  initializeDb(config);\n\n  initializeApi(app, config, utils, middleware);\n\n  if (config.production) {\n    app.use(express.static(path.join(__dirname, '../public')));\n\n    app.get('*', function (req, res) {\n      const filePath = path.resolve(__dirname, '../public/index.html');\n      res.sendFile(filePath);\n    });\n  }\n\n  return app;\n}"]}